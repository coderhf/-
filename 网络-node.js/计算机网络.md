# 物理层
1. 指设备之间的物理连接
   1. 可以是有线
      1. 网线（橙白，橙，绿白，蓝，蓝白，绿，棕白，棕）
      2. 除网线外其它都不是走的数字信号
      3. 光纤
      4. 电话线
   2. 可以是无线
      1. WiFi
      2. 3G
      3. 4G
2. 物理层解决信号的调制与解调
   1. 即数字信号与模拟信号之间的转换及传输
3. 保证通信的两端能够理解01
4. 把上层给到的数据转换为表示01的模拟信号传到电缆上
5. 把从电缆接收到的数据转换为01
6. 物理层还需要考虑
   1. 信号的时钟同步
      1. 为此使用了能够同步时钟信号的编码
      2. 即曼彻斯特编码（差分曼彻斯特编码）及其变种
   2. 电压（流）的大小
7. 数据包在不同层次的协议中的叫法不一样：
   1. 链路层：帧 frame
   2. 网络层：数据包
   3. TCP： 数据段
   4. UDP： 数据报
# 链路层
1. 链路层仅负责直接连接（包含通过交换机直接连接）的设备间的通信
   1. 实际上真正的网络通信也都是能过局域网一步步传过去的
2. 只关心直接连接的机器之间的以frame为单位的通信
3. 广播域（多台直接连接的设备组成一个广播域）
4. 集线器
5. 不同方式下链路层的实现有很多
   1. 以太网
      1. 载波侦听多路访问
      2. 用了交换机以后，基本不存在载波侦听多路访问
   2. WiFi
      1. 载波侦听多路访问
   3. GPRS，3G，4G
6. 目前最广泛使用的就是以太网
7. 在这一层，每个网卡会有一个全球唯一的MAC（Media Access Control Address）地址，用来标示这个设备的ID，虽然只在局域网内使用，但这个ID任然是唯一的
8. 局域网之间的通信是通过MAC地址的，而非IP地址
9. 计算机会通过ARP协议把IP地址转换为目标机器的MAC地址
10. 交换机就是典型的链路层设备（也称二层设备）
    1. 三层交换机.并不是运行在三层,也不做任何三层的事情
    2. 只是会识别ip地址等数据包里的三层包头来执行相关的策略
11. arp欺骗，广播风暴
12. 每台设备的ip地址，子网掩码，默认网关都是要手动设置的
    1. 为了不让普通用户手动设置，所以又有了DHCP协议，来自动获取网络地址配置信息
# 网络层（IP层）
1. 网络层负责把IP数据包（Packet）从起始机器送达目标机器
2. 路由器
   1. 真正的路由器，而非家用路由器
   2. 家用路由器是NAT路由
3. NAT网络地址转换
4. IP地址的分类
   1. A类 子网掩码长度为8
   2. B类 子网掩码长度为16
   3. C类 子网掩码长度为24
5. 特殊IP地址
   1. 127.* 永远指向当前计算机
   2. 0.0.0.0 代表当前机器的所有地址，当前机器还没有获取到ip地址时，代表自己的地址（DHCP）
   3. 255.255.255.255 广播地址
   4. x.y.255.255 特定网域的广播地址
   5. 10.* 预留的用于局域网的A类地址
   6. 172.xxx 预留的用于局域网的B类地址
   7. 192.168.* 预留的用于局域网的C类地址
   8. 224-239.*.*.* 多播地址，类似于频道，一般只在局域网中使用
6. DHCP Dynamic Host Configuration Protocal 动态主机配置协议
7. VPN一般是在这一层 Virtual Private Network 虚拟专用网络
   1. 借由现有网络虚拟一根网络插到某个远程的机房
   2. VPN某种程度上相当于把网线插到了VPN目标所在位置
   3. 一般的VPN连接后电脑会多出一个IP地址
8. DNS服务
   1. Domain Name Service 域名服务
   2. A 让域名指向一个ipv4地址
   3. AAAA 让域名指向一个ipv6地址
9. DDNS服务,Dynamic DNS 动态dns服务
   1.  家用宽度的ip地址是不固定的，那么如果我想有一个域名可以指向自己家里的ip地址，但ip不固定，难道我要每次ip换的时候都去重新设置域名的指向？
   2.  DDNS服务就是可以在客户机（即自己的电脑或设备如路由器）运算一个程序，一旦发现自己的ip变了，就自动去修改域名的指向
    
# 传输层
1. 网络层只负责ip到ip，即机器到机器之间的数据包传送
   1. 并不负责软件到软件，程序到程序之间的数据传送
2. 端口的概念在这一层提出

## UDP
* 像信箱
  * 非连接型
  * 给定目标位置直接扔过去
  * 无响应，不知道有没有送到
  * 接收方会校验数据的正确性，所以送到的话一般来说是对的

  * udp支持广播和组播，但只能在局域网中进行，广域网是不行的
  ```javascript
  // nodejs的程序不再运行于浏览器中
  // 而运行于操作系统的环境中，可以调用操作系统的各项api
  // 类似于各种其它语言的运行
  // 可以执行类似读取文件，修改/删除文件，启动程序，连接网络，关闭电脑，在右下角创建图标等功能


  // 获取udp模块
  var dgram = require('dgram')

  // 创建一个ipv4的udp套接字
  var socket = dgram.createSocket('udp4')
  var socket2 = dgram.createSocket('udp4')

  // 让这个socket绑定某个udp端口，注意范围0-65535，由于权限问题1024以上的端口是可以随意使用的，只要这个端口没有被其它程序占用
  socket.bind(12345)
  socket2.bind(12346)

  // 接下来就可以收发数据了

  // 
  socket.send('hello!', 10010, 'damiaoedu.com')

  // 当这个udp端口收到消息时触发事件
  socket.on('message', (data, info) => {
    // data是收到的数据
    // info是发送方的信息，如数据长度，发送方ip，发送方端口号

  })


  // 发送udp广播数据包
  socket.setBroadcast(true)
  socket.send('data', 11111, '255.255.255.255') // 给局域网中的所有设备发送广播消息
  socket.send('data', 11111, '192.168.1.255') // 给与自己在同一个网段的所有设备发广播

  // 发送udp组播，可以理解为把消息发送到一个频道，只有在帧听那个频道的socket可以收到
  // 组播有一组特殊的保留地址：224-239.*.*.*
  socket.setBroadcast(true)
  socket.send('data', 11111, '224.0.0.1') // 给频道224.0.0.1发送消息
  // 这种广播是会被交换机直接广播的
  // 接收方要加入频道：
  socket.addMembership('224.0.0.1')
  ```
* DHCP就是基于UDP的
    * dhcp需要广播
    * 默认服务器端口67
  * DNS协议也是基于UDP的
    * 默认服务器端口53
## TCP
* Transmission Control Protocol 传输控制协议
    * 保证数据送达：通过确认
    * 保证数据按序到达：通过对数据进行编号
  * 通信模型
    * 面向连接（有点像打电话，需要先接通）
    * 服务端端口
    * 客户端端口
    * tcp建立连接的常见错误：
      * connection refused 连接被拒绝
        * 表示服务器ip地址存在且可达，但服务器并没有在那个端口侦听，所以拒绝了
      * connection timeout 连接超时
        * 表示服务器ip长时间没有回应，可能是ip地址不可达（如ip地址填错，或远程机关机），也可能是服务器故意没有回应
      * connection reset 连接被重置
        * 连接发生了不可恢复的错误，无法继续，需要重置，重置会导致连接断开
        * 这个错误往往是因为收到了一个要求重置连接数据包
    
  * 包头
    * 序号：表示这个包中数据部分的第一个字节是这个连接上发送过去的第几个字节
    * 确认号：表示接收方已经收到了第几个字节之前的所有数据，期待收到第几个字节的数据
    * 以上两个值都不是从真正的0开始的，而是将一个随机数做为0，从那个“0”开始的，在建立连接的时候会确定这个随机数
    * 接收窗口大小：
  * 握手
    * 分享初始的接收窗口大小
    * 确认对方可达
  * 保证按顺送达
  * 滑动窗口机制
    * 拥塞窗口，用于拥塞控制
      * 和式增加，积式减少（AIMD）
    * （对方的）接收窗口，用于不要发送过多的数据以至于对方处理不过来
    * 等对方确认收到了窗口前面的字节，再发送后面的数据，同时窗口往后滑动
  * 状态转换图
  * 可能的面试重点：
    * 协议/连接模型
    * 常见报错 refused timeout reset
    * 包头有哪些字段，分别代表什么意思
    * 滑动窗口机制
    * 三次握手
    * 四/三次挥手
    * 粘包（伪概念）
    * 队头阻塞
  * TCP与UDP的区别
    * 面向连接的字节流与面向消息
    * udp不保证送达，tcp会保证送达（网络条件允许的情况下）
    * 适用场景不同
      * 游戏，语音通话，直播等，会更合适udp
      * 而需要可靠传输较大量数据的场景更适合tcp
    * udp延迟更小，因为没有队头阻塞
    * tcp由于存在队头阻塞，一些数据的交付延迟可能会比udp要大

# 应用层
* 直接使用TCP或UDP传输自己关心的数据，不关心下层细节（包头，重传，拥塞等）
* DHCP - UDP - IP
  * 它需要广播功能，而tcp是没有广播功能的（即使在局域网中）
  * DHCP有必要使用tcp吗？为什么？
    * 没有必要，因为dhcp并不传输大量的数据，它所需要传输的数据都可以在一个数据包中放下
* DNS - UDP - IP
  * dns协议的通信内容并不大，一个udp包就能放得下，且dns只需要一问一答
  * 事实上现在已经存在dns over tcp和dns over https
    * 这两者的出现都是为了防止dns污染/劫持/欺骗
* NTP Network Time Protocol 网络时间协议，用来给计算机对时的
  * NTP - UDP
    * 一方面，ntp通信内容也很少，一个udp包足够
    * ntp需要协议不要额外占用时间，以减少误差
    * tcp有一些额外的不受调用者控制且调用者不可知的延迟（如握手，重传）
  * ntp攻击
* FTP File Transfer Protocol
  * FTP - TCP - IP
  * 它不是单次一问一答的协议，而是连续的问答协议
    * 建立一个连接，在这个连接连续对话
  * 数据传送通道与控制指令通道是两个连接
* HTTP
  * 与ftp一样都是纯文本协议
    * 其它的多数协议，包头里的数据都是以二进制编码的
  * 与dns/ntp一样都是**请求响应模型**
    * dns是请求域名的ip/响应对应的结果
    * ntp是请求时间/响应时间
    * http是请求“资源”/响应“资源”，对“资源”的请求与响应
      * 在http中，资源是使用URI/URL唯一定位/标识的
  * http协议基于TCP协议
    * 因为它可能需要传输大量的数据，而tcp正好可以提供这种保证


# 计算机网络题目与答案
1. 查询计算机网络配置信息的命令是什么？
  * ipconfig(windows)
  * ifconfig(linux), interface config
2. ping命令做了什么？抓包查验证。
  * 发送了请求响应的icmp包，收到了响应该请求的icmp包
3. 什么是mac地址
  * 介质访问控制
4. 交换机和集换器有什么区别？
  * 集线器属于物理层设备，即不能识别链路层的数据包，总是将数据从所有口广播出去
  * 交换机属性链路层设备，会识别数据包中的mac地址并将数据包从正确的接口送出
5. 交换机的接口有mac地址吗？为什么？
  * 没有。不是把数据发给交换机的接口，而是通过交换机将数据转发到其它主机。
6. 什么叫网关交换机？
  * 即三层交换机，能够识别网络层数据包的内容，并作出相应的操作
  * 防止arp欺骗
  * 但本质还是只转发链路层数据包
7. 何为载波侦听多路访问？
  * 多个设备会同时访问该信道
  * 设备发送数据时会同时监听有无收到数据
8. 为何要使用曼彻斯特编码？
  * 为了时钟同步，曼彻斯特编码在每个时钟周期都会有信号跳变，可以用来同步
9. 为何要做时钟同步?
  * 因为不同的设备总会有误差 
10. 网络与快递的相似之处体现在什么地方 ？
  * 各种地方：
    拓扑结构（主干是网状结构，末端是树状结构）
    转发。数据包在网络中是由各设备转发。包裹在送递过程中也是在不同的网点之间转移
    包格式与快递单很相似。
11. 为什么ip地址是按地区划分的？
  * 路由器是放在不同地区的，之间有连接
  * 路由器中的路由表是根据目的地IP的前缀来确定数据包的出口的
  * 所以相同前缀的IP地址会送往相同的方向
    * 结果就是同一个地区的IP的前缀相同
    * 类似快递的地址
12. 抓包查看并验证tracert的原理。
13. 如何理解VPN？它工作在哪一层？
  * 设备上创建了一张虚拟卡，用一根由现有网络构成的虚拟网线插到了远程VPN机房
  * 有些在第二层，有些在第三层
14. IP数据包是如何到达目地址的？
  * 通过中间的所有设备中转到达的
15. IPv6如何在现行网络上工作？
  * IPv6 over IPv4
  具体来说，即将v6的包封装成v4的包里送到某个同时连接了v4和v6网络的路由器
  那个路由器再将v6的包解出来，转发到v6网络上
16. 请说出UDP协议的通信模型。
  * 每个udp套接字就像一个信箱，可以给其它任意udp套接字发送消息，也可以接收来自其它任意udp套接字的消息。
  消息不保证送达，也不保证按顺序到达。
17. 如何可以知道某台机器的某个udp端口是否打开？
  * 无法知道。
  除非发过去消息并得到了回应，说明它开着。
18. 0.0.0.0与255.255.255.255这两个地址在不同情况代表什么？
  * 0.0.0.0在dhcp的请求阶段发出去的包中，代表发送者自己的ip
  在udp/tcp监听某个端口但不指定ip时，0.0.0.0代表本机的所有ip地址

  255.255.255.255是广播地址，代表该域上的所有主机的ip
19. DHCP是什么？其协商过程是怎样的？为什么会有租约时间的限制？
  * 动态主机配置协议，用于为新接入网络的主机配置ip，网关，dns等信息
20. 物理层、链路层、网络层、传输层分别主要关心的是什么？
  * 物理层关心01的正确表示与传输
  链路层关心相互连接的机器之间的数据包传输
  网络层实现了网络中任意两台机器间的传输
  传输层关心两个应用程序间的数据传输
  应用层关心输的数据本身要怎样表示
21. 什么是MTU？典型值是多少？什么情况下其大小不是典型值？
  * Max Transport Unit，最大传输单元
    以太网：1500
    IP层：1480
    UDP：1472
22. 什么情况下其大小不是典型值？
    IPv6 Over IPv4
    VPN

23. 带宽与延迟分别代表什么？说出常见应用更关注带宽还是延迟。
  如果把网络比做公路
    带宽代表公路的宽度
    延迟代表公路的长度
      游戏，语音：更关心延迟
      下载，在线视频：更关心带宽
      直播：延迟与带宽都关心
用手机流量连接教室vpn以实现查看我电脑上的共享文件。




24. TCP端口的监听状态是什么意思？
  指服务器程序在某端口等待其它客户端连接
25. TCP基于连接是什么意思？
  通信之前要先建立连接，连接成功后双方仅可以在这个连接上相互收发信息
26. TCP的协议模型是什么？
  服务器在某端口监听，多个客户端可以同时连接到这个服务器端口
27. TCP协议如何保证数据的按序送达？
  为数据编号
28. TCP与UDP有什么区别？为什么需要TCP？
  tcp基于连接的，而udp不是
  tcp要先建立连接，udp不用
  tcp能保证数据按序送达，udp不能
  tcp以字节流的方式通信，udp以消息/数据包的方式通信
  udp可以在局域网广播，tcp不能
29. 为什么需要TCP？
    当需要数据被保证按序送达时，需要tcp，即使不使用tcp，最终也会自己实现一个拙劣的tcp
30. 为什么DNS，DHCP等协议是基于UDP而不是基于TCP的？
  DNS，DHCP等协议的数据在一个UDP包中就可以完全表达
    DHCP基于UDP还因为其需要广播

31. 为什么TCP服务端可以用同一个端口与无数其它机器建立TCP连接？
  因为发送到该端口的数据包会按来源ip与来源端口进行分组，相同的来源ip与端口的数据包会被分在一个组里，当成同一个连接的数据

32. 如何探测某主机的一个端口是否处于TCP服务监听状态？
  尝试连接
  net.connect(553, '127.0.0.1')
  nc  115.35.244.22  5544
  telnet     ip   port

33. TCP协议有哪些状态？状态之间是如何迁移的？
如何查看电脑上有哪些程序正在监听哪些TCP端口？
  window： 资源监视器
  linux： ss -l命令

34. 为什么Inletex Easy Meeting Classic软件画面从来不会花但是人多时会比较卡？
  该软件使用tcp进行画面的传输。
  tcp是不支持广播的，所以人越多，网络负担就越大，也就越卡

35. 红蜘蛛为什么会花屏？但为什么不卡？
  红蜘蛛使用的是局域网udp广播或多播，数据包在每根网线上只走了一次，跟人数无关
  但udp不能保证数据送达，所以会花屏

36. 为什么TCP建立链接需要3次握手？所谓的握手是什么意思？
  根本原因是双方进行一次有效的信息交换至少需要3次单向沟通
  握手指的是发送了三个数据锯
37. 为什么TCP断开连接需要4次挥手？
  也可能是三次。
  因为tcp连接支持半开，即一方不发送数据了，但还可以接收数据
38. TCP协议的滑动窗口是什么？

39. TCP的序列号是什么？其代表什么？
  表示本数据包中数据的第一个字节是发过的第几个字节
40. 确认号是什么？其代表什么？
  已经收到这个字节前的所有字节
41. 序列号与确认号为什么是随机的？
  为了防止被伪造的数据撞进接收窗口里
42. 什么是TCP四元组？
  由  （源ip，源端口，目的ip，目的端口）  这四个信息组成的整个信息


43. 抓包查看TCP连接的握手，数据传输，ACK及挥手的的数据包。
44. 在自己电脑上建立TCP服务端口并让多于两个客户端连接进来以理解TCP的协议模型。
45. 什么是域名的A记录，CNAME，MX记录？域名查询命令是什么？
  NSLOOKUP
  DIG
  PING
46. 如何查看UDP端口是否绑定成功？有什么命令？
  资源监视器/端口侦听
    对于tcp，侦听指等待连接
    对于udp，侦听指等待数据
  SS -UL
47. hosts文件是什么？有什么作用与应用？
  用来在本地上让一些域名指向设定的ip的

48. DNS服务是用来干嘛的？其服务端口是多少？
  53
DHCP服务端口为67
NTP服务端口为123


网络安全：
  通信安全
    通信的对方是不是想要通信的对方
    通信的内容不被中间设备截获和篡改


常见网络攻击手段：

局域网：
  ping攻击（网管交换机限制流量）
  ARP欺骗（网管交换机）
  广播风暴（禁止广播）

广域网：
  伪造IP数据包。
  TCP SYN Flood
  TCP DoS Deny of Service Attack
  NTP 时间服务器攻击




计算机不能上网的一般解决方案

ping www.baidu.com

ping 114.114.114.114

ping 10.0.0.1

nc  xxx  80

ss -l  -n
